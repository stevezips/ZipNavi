<HTML:5>
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>ZipFund Second Page</title>
        <script src="../js/jquery.js"></script>
    </head>
    <body style="background-color: #474747; overflow: hidden;">
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
        <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fb926e363d9a87e9712ed240cb75a7b0&libraries=services"></script>
        <style>
            .container{
                height: 100%;
                display: flex;
                overflow: auto;
                overflow-y: scroll;
                scroll-snap-type: y mandatory;
            }
            #kakao_map{
                margin-left: 5%;
                width: 90%;
                height: 500px;
                z-index: 1;
            }
            #txt_address{
                width: 1000px;
                position: absolute;
                font-size: 30px; 
                font-weight: bold;
                color: #007ac3;
                margin-top: 20px;
                margin-left: -500px;
            }
            #first_page{
                padding-top: 10%;
                height:90%;
                width: 100%;
            }
            #first_page_left{
                width: 50%;
                height: 90%;
                float: left;
            }
            #first_page_right{
                width: 50%;
                height: 90%;
                display:inline-block;
                text-align: center;
            }
            #first_page_bottom{
                height: 10%;
                width:100%;
                text-align: center;
                float:top;
            }
            #first_page_chart{
                margin-left: 10%;
                width: 80%;
                height: 80%;
            }
            #second_page_top{
                text-align: center;
                float:top;
            }
            .checks {position: relative;}

            .checks input[type="checkbox"] {  /* 실제 체크박스는 화면에서 숨김 */
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip:rect(0,0,0,0);
                border: 0
            }
            .checks input[type="checkbox"] + label {
                display: inline-block;
                position: relative;
                cursor: pointer;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
            }
            .checks input[type="checkbox"] + label:before {  /* 가짜 체크박스 */
                content: ' ';
                display: inline-block;
                width: 30px;  /* 체크박스의 너비를 지정 */
                height: 30px;  /* 체크박스의 높이를 지정 */
                line-height: 30px; /* 세로정렬을 위해 높이값과 일치 */
                margin: 0 15px 0 0;
                text-align: center; 
                vertical-align: middle;
                background: #fafafa;
                border: 1px solid #cacece;
                border-radius : 3px;
                box-shadow: 0px 1px 2px rgba(0,0,0,0.05), inset 0px -15px 10px -12px rgba(0,0,0,0.05);
            }

            .checks.etrans input[type="checkbox"] + label {
                padding-left: 30px;
            }
            .checks.etrans input[type="checkbox"] + label:before {
                position: absolute;
                left: 0;
                top: 0;
                margin-top: 0;
                margin-left: -10px;
                opacity: .6;
                box-shadow: none;
                border-color: #6cc0e5;
                -webkit-transition: all .12s, border-color .08s;
                transition: all .12s, border-color .08s;
            }

            .checks.etrans input[type="checkbox"]:checked + label:before {
            position: absolute;
            content: "";
            width: 10px;
            top: -5px;
            left: 5px;
            border-radius: 0;
            opacity:1; 
            background: transparent;
            border-color:transparent #6cc0e5 #6cc0e5 transparent;
            border-top-color:transparent;
            border-left-color:transparent;
            -ms-transform:rotate(45deg);
            -webkit-transform:rotate(45deg);
            transform:rotate(45deg);
            }

            .no-csstransforms .checks.etrans input[type="checkbox"]:checked + label:before {
            /*content:"\2713";*/
            content: "\2714";
            top: 0;
            left: 0;
            width: 30px;
            line-height: 30px;
            color: #6cc0e5;
            text-align: center;
            border: 1px solid #6cc0e5;
            }
            .checks.etrans{
                margin-top: 50px;
            }
            .highcharts-background{
                fill: #474747
            }
            tspan{
                font: bold 20px sans-serif; fill: white;
            }
        </style>
        <main id="container">
            <section id="main_screen">
                <img src="../images/project_logo.png" style="position:fixed; height: 10%; float: left;" onclick="moveTop()">
                <div id="address_search_panel" style="position: absolute; width: 100%; text-align: center; z-index: 3;">
                    <h id="txt_address">주소가 들어갈 곳입니다</h>
                </div>
                <div id="first_page">
                    <div id="first_page_left">
                        <div id="kakao_map"></div>
                        <div style="display: flex; justify-content: center;">
                            <div class="checks etrans" style="margin-top: 10px;">
                                <input type="checkbox" id="check_medical">
                                <label for="check_medical" style="margin-right: 20px; color: white; font-size: 21px; font-weight:bold;">의료시설</label>
                                <input type="checkbox" id="check_school">
                                <label for="check_school" style="margin-right: 20px; color: white; font-size: 21px; font-weight:bold;">교육시설</label>
                                <input type="checkbox" id="check_market">
                                <label for="check_market" style="margin-right: 20px; color: white; font-size: 21px; font-weight:bold;">마트 및 편의점</label>
                                <input type="checkbox" id="check_restaurant">
                                <label for="check_restaurant" style="margin-right: 20px; color: white; font-size: 21px; font-weight:bold;">음식점 및 카페</label><br><br>
                                <input type="checkbox" id="check_public">
                                <label for="check_public" style="margin-right: 20px; color: white; font-size: 21px; font-weight:bold;">공공시설</label>
                                <input type="checkbox" id="check_subway">
                                <label for="check_subway" style="margin-right: 40px; color: white; font-size: 21px; font-weight:bold;">지하철</label>
                                <input type="checkbox" id="check_culture">
                                <label for="check_culture" style="margin-right: 77px; color: white; font-size: 21px; font-weight:bold;">문화시설</label>
                                <input type="checkbox" id="check_motel">
                                <label for="check_motel" style="color: white; font-size: 21px; font-weight:bold;">관광명소 및 숙박</label>
                            </div>
                        </div>
                    </div>
                    <div id="first_page_right">
                        <div id="first_page_chart"></div>
                    </div>
                    <div id="first_page_bottom">
                        <img style="width: 100px; margin-top: -50px;" src="../images/arrow_down.png"
                        onmouseover="this.src='../images/arrow_down_white.png'" 
                        onmouseout="this.src='../images/arrow_down.png'"
                        onclick="moveSecond()">
                    </div>
                </div>
            </section>
            <section id="second_screen" style="height:100%;">
                <div id="second_page_top">
                    <img style="width: 100px;" src="../images/arrow_up.png"
                        onmouseover="this.src='../images/arrow_up_white.png'" 
                        onmouseout="this.src='../images/arrow_up.png'"
                        onclick="moveTop()">
                </div>
            <!--
                <div id="second_screen_first_line" style="padding-top:15%; height:10%; text-align: center;">
                    <input type="image" src="../images/second_screen_first_line.png" disabled="true">
                </div>
                <div id="second_screen_second_line"style="height:10%; text-align:center;">
                    <input type="image" src="../images/second_screen_second_line.png"disabled="true">
                </div>
                <div id="second_screen_third_line"style="height:10%; text-align:center;">
                    <input type="image" src="../images/second_screen_third_line.png"disabled="true">
                </div>
                <div id="second_screen_fourth_line"style="height:10%; text-align:center;">
                    <input type="image" src="../images/second_screen_fourth_line.png"disabled="true">
                </div>
                <div id="address_search_panel" style="margin-top: 25px; width: 100%; height: 30%; text-align: center;">
                    <input type="text" id="sample_address" class="address_search" placeholder="찾고자 하는 지역의 '구', '동'을 입력하세요.">
                    <input type="image" onclick="SearchAddress()" src="../images/zoom_2.png" style="vertical-align: middle; width: 30px; height: 30px;" onfocus="this.blur()"><br>
                    <h1 id="txt_address" style="font-size: 18px; font-weight: bold; font-style: italic; color: #007ac3;"> </h1>
                </div>
            -->
            </section>
        </main>
        <script>
            //variables of user
            var x, y, age, gender, old, high, midd, elem, kind, dog, active, address_name;
            var marker;
            search = window.location.search;
            getData = _GET(search);
            x = getData.x;
            y = getData.y;
            age = getData.age;
            gender = getData.gender;
            old = getData.old;
            high = getData.high;
            midd = getData.midd;
            elem = getData.elem;
            kind = getData.kind;
            dog = getData.dog;
            active = getData.active;
            address_name = getData.addr;
            var container = document.getElementById("kakao_map");
            var options = {
                center: new kakao.maps.LatLng(y, x),
                level: 5
            };
            marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(y, x)
            });
            var circle = new kakao.maps.Circle({
                center : new kakao.maps.LatLng(y, x),  // 원의 중심좌표 입니다 
                radius: active * 1000, // 미터 단위의 원의 반지름입니다 
                strokeWeight: 3, // 선의 두께입니다 
                strokeColor: '#007ac3', // 선의 색깔입니다
                strokeOpacity: 1, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
                strokeStyle: 'dashed', // 선의 스타일 입니다
                fillColor: '#CFE7FF', // 채우기 색깔입니다
                fillOpacity: 0.5  // 채우기 불투명도 입니다   
            });
            var map = new kakao.maps.Map(container, options);
            marker.setMap(map);
            circle.setMap(map);
            $("#txt_address").html("<h>" + address_name + "</h>");
            function category(){
                return {
                    place_name_1: "",
                    place_num: 0
                }
            }
            codes = new Array();
            for(var i = 0; i < 14; i++){
                codes[i] = new category();
            }
            var ps = new kakao.maps.services.Places(map);
            //var infowindow = new kakao.maps.InfoWindow({zIndex:1});
            // 병원 관련
            codes[0].place_name_1="HP8";  // 병원
            codes[1].place_name_1="PM9";  // 약국
            var hospital = [];
            var hospital_markers = [];
            // 학군 관련
            codes[2].place_name_1='PS3';    // 유치원
            codes[3].place_name_1='SC4';    // 학교
            codes[4].place_name_1='AC5';    // 학원
            var school = [];
            var school_markers = [];
            // 장보기 관련
            codes[5].place_name_1='MT1';    // 마트
            codes[6].place_name_1='CS2';    // 편의점
            var mart = [];
            var mart_markers = [];
            // 문화시설
            codes[7].place_name_1='CT1';    // 문화시설
            var culture = [];
            var culture_markers = [];
            // 음식점과카페
            codes[8].place_name_1='FD6';    // 음식점
            codes[9].place_name_1='CE7';    // 카페
            var restaurant = [];
            var restaurant_markers = [];
            // 공공기관과 지하철
            codes[10].place_name_1='PO3';   // 공공시설
            var public_place = [];
            var public_place_markers = [];
            codes[11].place_name_1='SW8';   // 지하철
            var subway = [];
            var subway_markers = [];
            // 관광명소와 숙박
            codes[12].place_name_1='AT4';   // 관광명소
            codes[13].place_name_1='AD5';   // 숙박
            var travel = [];
            var travel_markers = [];

            for(var i = 0; i < codes.length; i++){
                ps.categorySearch(codes[i].place_name_1, placeSearchCB, {
                    page: 1, size: 15, location: new kakao.maps.LatLng(y, x),
                    radius: active * 1000
                });
                ps.categorySearch(codes[i].place_name_1, placeSearchCB, {
                    page: 2, size: 15, location: new kakao.maps.LatLng(y, x),
                    radius: active * 1000
                });
                ps.categorySearch(codes[i].place_name_1, placeSearchCB, {
                    page: 3, size: 15, location: new kakao.maps.LatLng(y, x),
                    radius: active * 1000
                });
            }
            function placeSearchCB (data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    for (var j=0; j<data.length; j++) {
                        var obj = {name : data[j].place_name, dist : data[j].distance, x : data[j].x, y : data[j].y};
                        if(data[j].category_group_code == 'HP8' && !hospital.includes(obj)){
                            hospital.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'PM9' && !hospital.includes(obj)){
                            hospital.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'PS3' && !school.includes(obj)){
                            school.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'SC4' && !school.includes(obj)){
                            school.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'AC5' && !school.includes(obj)){
                            school.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'MT1' && !mart.includes(obj)){
                            mart.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'CS2' && !mart.includes(obj)){
                            mart.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'CT1' && !culture.includes(obj)){
                            culture.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'FD6' && !restaurant.includes(obj)){
                            restaurant.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'CE7' && !restaurant.includes(obj)){
                            restaurant.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'PO3' && !public_place.includes(obj)){
                            public_place.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'SW8' && !subway.includes(obj)){
                            subway.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'AT4' && !travel.includes(obj)){
                            travel.push(Object.entries(obj));
                        }
                        if(data[j].category_group_code == 'AD5' && !travel.includes(obj)){
                            travel.push(Object.entries(obj));
                        }
                    }/*
                    for(var i = 0; i < codes.length; i++){
                        if(data[0].category_group_code == codes[i].place_name_1){
                            window.codes[i].place_num = data.length;
                        }
                    }*/
                }
                return data.length;
            }
            
            window.onload = function(){
                viewFirstChart();
            }

            $("#check_medical").change(function(){
                if($("#check_medical").is(":checked")){
                    for(var item in hospital){
                        var nameM = hospital[item][0][1];
                        var xPos = hospital[item][2][1];
                        var yPos = hospital[item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        hospital_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in hospital_markers){
                        hospital_markers[item].setMap(null);
                    }
                    hospital_markers = [];
                }
            });

            $("#check_school").change(function(){
                if($("#check_school").is(":checked")){
                    for(var item in school){
                        var nameM = school[item][0][1];
                        var xPos = school[item][2][1];
                        var yPos = school[item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        school_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in school_markers){
                        school_markers[item].setMap(null);
                    }
                    school_markers = [];
                }
            });

            $("#check_market").change(function(){
                if($("#check_market").is(":checked")){
                    for(var item in mart){
                        var nameM = mart [item][0][1];
                        var xPos = mart [item][2][1];
                        var yPos = mart [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        mart_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in mart_markers){
                        mart_markers[item].setMap(null);
                    }
                    mart_markers = [];
                }
            });

            $("#check_restaurant").change(function(){
                if($("#check_restaurant").is(":checked")){
                    for(var item in restaurant){
                        var nameM = restaurant [item][0][1];
                        var xPos = restaurant [item][2][1];
                        var yPos = restaurant [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        restaurant_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in restaurant_markers){
                        restaurant_markers[item].setMap(null);
                    }
                    restaurant_markers = [];
                }
            });

            $("#check_public").change(function(){
                if($("#check_public").is(":checked")){
                    for(var item in public_place){
                        var nameM = public_place [item][0][1];
                        var xPos = public_place [item][2][1];
                        var yPos = public_place [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        public_place_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in public_place_markers){
                        public_place_markers[item].setMap(null);
                    }
                    public_place_markers = [];
                }
            });

            $("#check_subway").change(function(){
                if($("#check_subway").is(":checked")){
                    for(var item in subway){
                        var nameM = subway [item][0][1];
                        var xPos = subway [item][2][1];
                        var yPos = subway [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        subway_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in subway_markers){
                        subway_markers[item].setMap(null);
                    }
                    subway_markers = [];
                }
            });

            $("#check_culture").change(function(){
                if($("#check_culture").is(":checked")){
                    for(var item in culture){
                        var nameM = culture [item][0][1];
                        var xPos = culture [item][2][1];
                        var yPos = culture [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        culture_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in culture_markers){
                        culture_markers[item].setMap(null);
                    }
                    culture_markers = [];
                }
            });

            $("#check_motel").change(function(){
                if($("#check_motel").is(":checked")){
                    for(var item in travel){
                        var nameM = travel [item][0][1];
                        var xPos = travel [item][2][1];
                        var yPos = travel [item][3][1];
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: new kakao.maps.LatLng(yPos, xPos)
                        });
                        var infowindow = new kakao.maps.InfoWindow({
                            content: nameM // 인포윈도우에 표시할 내용
                        });
                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        travel_markers.push(marker);
                    }
                    //this.hospital_markers.setMap(this.map);
                } else {
                    for(var item in travel_markers){
                        travel_markers[item].setMap(null);
                    }
                    travel_markers = [];
                }
            });

            function makeOverListener(map, marker, infowindow) {
                return function() {
                    infowindow.open(map, marker);
                };
            }

            // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
            function makeOutListener(infowindow) {
                return function() {
                    infowindow.close();
                };
            }



            function viewFirstChart(){
                Highcharts.chart('first_page_chart',{
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: '주변 환경 정보',
                    style: {
                        "color": "#007ac3",
                        "font-size": "30px",
                        "fill": "#007ac3"
                    }
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },plotOptions: {
                    pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: false
                    },
                    showInLegend: true
                    }
                },
                series: [{
                    name: '비율',
                    colorByPoint: true,
                    data: [{
                    name: '병원',
                    y: hospital.length,
                    sliced: true,
                    selected: true
                    }, {
                    name: '학군',
                    y: school.length
                    }, {
                    name: '장보기',
                    y: mart.length
                    }, {
                    name: '문화시설',
                    y: culture.length
                    }, {
                    name: '음식점 및 카페',
                    y: restaurant.length
                    }, {
                    name: '공공시설',
                    y: public_place.length
                    }, {
                    name: '지하철',
                    y: subway.length
                    }, {
                    name: '관광지 및 숙박업소',
                    y: travel.length
                    }]
                }]
            });
            }
            

            
            
            /*
            _GET : function for get data from url
            return array type
            */
            function _GET(search){
                var obj = {};
                var uri = decodeURI(search);
                uri=uri.slice(1,uri.length);
                var param = uri.split('&');
                for(var i = 0; i < param.length; i++){
                    var devide = param[i].split('=');
                    obj[devide[0]] = devide[1];
                }
                return obj;
            }
            function moveTop(){
                var offset=$("#main_screen").offset();
                $("html body").animate({scrollTop:offset.top}, 500);
            }
            function moveSecond(){
                var offset=$("#second_screen").offset();
                $("html body").animate({scrollTop:offset.top}, 500);
            }
        </script>
    </body>
    </html>
</HTML:5>